<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PPM Property Map</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .legend {
            position: absolute; bottom: 30px; left: 10px; z-index: 1000;
            background: white; padding: 10px; border-radius: 6px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 12px;
        }
        .legend-item { margin: 2px 0; display: flex; align-items: center; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; margin-right: 6px; }
        .debug { 
            position: absolute; top: 10px; left: 10px; z-index: 1000;
            background: white; padding: 8px; border-radius: 4px; font-size: 11px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="debug" class="debug">Loading...</div>
    
    <div class="legend">
        <strong>Property Status</strong>
        <div class="legend-item">
            <div class="legend-color" style="background: #ff0000;"></div>
            Lockbox Needed
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #ffff00; border: 1px solid #ccc;"></div>
            Photos Needed
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #0000ff;"></div>
            Eyes-On Needed
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #00ff00;"></div>
            Banner/Sign Needed
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #808080;"></div>
            Complete
        </div>
    </div>
    
    <div id="map"></div>
    
    <script>
        // Replace YOUR_MAPBOX_TOKEN_HERE with your actual token
        mapboxgl.accessToken = 'pk.eyJ1IjoiYnVuZHlrMTIiLCJhIjoiY21oY2NuZWMwMjEycDJucTMyM3B6dXJxZyJ9.eaWSaIsHytWE8odV_Lnhmg';
        
        const debugDiv = document.getElementById('debug');
        debugDiv.textContent = 'Initializing map...';
        
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [-104.9903, 39.7392], // Denver coordinates
            zoom: 11
        });

        // Test properties - these should definitely appear
        const testProperties = [
            { name: 'Test Property 1', lat: 39.7391, lng: -104.9847, color: '#ff0000', status: 'Lockbox Needed' },
            { name: 'Test Property 2', lat: 39.7531, lng: -104.9803, color: '#ffff00', status: 'Photos Needed' },
            { name: 'Test Property 3', lat: 39.7392, lng: -104.9903, color: '#0000ff', status: 'Eyes-On Needed' }
        ];

        // Add markers when map loads
        map.on('load', function() {
            debugDiv.textContent = 'Map loaded. Adding markers...';
            console.log('Map loaded successfully');
            
            let markersAdded = 0;
            
            testProperties.forEach((property, index) => {
                try {
                    console.log(`Adding marker ${index + 1}: ${property.name}`);
                    
                    // Create marker
                    const marker = new mapboxgl.Marker({ 
                        color: property.color,
                        scale: 1.5  // Make them bigger and easier to see
                    })
                    .setLngLat([property.lng, property.lat])
                    .addTo(map);

                    // Add popup
                    const popup = new mapboxgl.Popup({ offset: 25 })
                        .setHTML(`
                            <div style="padding: 8px;">
                                <h3 style="margin: 0 0 8px 0;">${property.name}</h3>
                                <p style="margin: 0;"><strong>Status:</strong> ${property.status}</p>
                                <p style="margin: 4px 0 0 0; font-size: 11px; color: #666;">
                                    Location: ${property.lat.toFixed(4)}, ${property.lng.toFixed(4)}
                                </p>
                            </div>
                        `);

                    marker.setPopup(popup);
                    markersAdded++;
                    
                    console.log(`Marker ${index + 1} added successfully`);
                    
                } catch (error) {
                    console.error(`Error adding marker ${index + 1}:`, error);
                }
            });
            
            debugDiv.textContent = `${markersAdded} markers added successfully`;
            console.log(`Total markers added: ${markersAdded}`);
            
            // Hide debug info after 3 seconds if successful
            if (markersAdded === testProperties.length) {
                setTimeout(() => {
                    debugDiv.style.display = 'none';
                }, 3000);
            }
        });

        // Error handling
        map.on('error', function(e) {
            console.error('Map error:', e);
            debugDiv.textContent = 'Map error - check console';
            debugDiv.style.background = '#ffebee';
            debugDiv.style.color = '#c62828';
        });
        
        // Style load event
        map.on('style.load', function() {
            console.log('Map style loaded');
        });
    </script>
</body>
</html>
